# Agents.MD

**Purpose:** This file briefs a code-generation agent on the current project, target behavior, constraints, and how to write code that fits the repository. Follow it to implement features confidently and produce a production-quality Maryland child support calculator web app with PDF output.

---

## 0) Project Snapshot

 - **Name:**  md-child-support
  - **Goal:**  Compute Maryland child support per statute and judiciary worksheets; export a court-style PDF.
 - **Language/Stack:**  TypeScript (strict), Node.js, Vitest for tests, Zod for schema validation, ts-node for CLIs.
 - **Current modules (already present):j
    - src/schema.ts â€” Zod schemas & types for inputs/outputs (includes `CaseInputs`, `CaseOutputs`, `CustodyType`, aAddOns`, `DirectPay`).
    - src/schedule.ts â€” Types + demo schedule + `lookupBasicObligation` (next-higher-row rule; flags `aboveTop`).
    - src/addons.ts â€” `totalAddOns`, `splitByShare`, `directPayTotalForParent`, `directPayConsistencyWarning`.
    - src/calc.ts â€” Worksheet A core (`computeBasic`, `computePrimaryTotals`, `computePrimaryFinal`).
    - src/shared.ts â€” Worksheet B core (`sharedStarter`, cross-payments, 92â€“109 adjustment, cap vs A, `computeSharedFinal`).
    - src/multifamily.ts â€” Multifamily allowance (0.75 Â  base for one child using that parentâ€™s income Â  count).
    - CLIs/tests: src/cli.ts, tests in tests/.
 - **Build/Test:**
    - `npm run typecheck` xâ€“ strict TS check
    - `npx vitest` ˆâ€Œ unit tests

---

## 1) Regulatory & Math Model (what the app must implement)

## A. Core definitions
- **AAI (Adjusted Actual Income)** per parent (monthly):
  ```
  AAI = actualMonthly
        - preexistingSupportPaid
        - alimonyPaid
        + alimonyReceived
        - multifamilyAllowance
  ```
- **Multifamily allowance:** for each additional child living in that parentâ€™s home (not in this case):
  1) Look up **Basic obligation for 1 child** using **ONLY** that parentâ€™s income, applying **Next-Higher-Row** rule.
  2) Multiply by *0.75*.
  3) Multiply by *count* of such in-home children.
  4) Subtract from that parentâ€™s actual income before computing AAI.
- **Schedule lookup**. Use combined AAI and number of children in this case.
  - If combined AAI is between rows â€” pick *next higher row**.
  - If above the top row â€” * discretionary** (flag `aboveTop`).

---

J